---
- include: set_hostname.yaml
- hosts: all
  become: yes
  tasks:
      - name: download the puppet deb package
        shell: wget http://apt.puppetlabs.com/puppet-release-{{ ansible_distribution_release }}.deb -O /tmp/puppet-release-{{ ansible_distribution_release }}.deb
      - name: Install puppetlabs repositories
        apt:
#          deb: "http://apt.puppetlabs.com/puppet-release-{{ ansible_distribution_release }}.deb"
# it doesn't work
           deb: "/tmp/puppet-release-stretch.deb"
#      - name: Install PuppetLabs release DEB for Debian derivates
#        apt: pkg=puppet state=latest update_cache=yes
#        with_items:
#        - "http://apt.puppetlabs.com/puppet-release-{{ ansible_distribution_release }}.deb"
#        when: ansible_os_family == 'Debian'
#        tags:
#         - repo
#         - install
#         - packages
      - name: Install puppets correct version
        apt: name=puppet state=present update_cache=yes
      - name: Render puppet configuration file
        template: dest=/etc/puppet/puppet.conf src=puppet.conf.j2
- include: set_hosts_from_inventorylist_to_etc_hosts.yaml

# # important
  # playbook command with sudo
